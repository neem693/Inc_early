<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
    namespace="com.anylogic.iot.api.admin.onm.mapper.CodeMapper">


    <!--  코드상세 - selectCode -->
    <select id="selectCode" parameterType="Map" resultType="Map">

        SELECT
            code_id
            , codegroup_id
            , code_name
            , code_level
            , rank
            , description
            , create_id
            , to_char(create_dt,'YYYY-MM-DD hh24:mi:ss') as create_dt
            , update_id
            , to_char(update_dt,'YYYY-MM-DD hh24:mi:ss') as update_dt
            , del_yn
            , ROW_NUMBER() OVER( order by code_id ) as RNUM 
        FROM sdp.tb_code
        WHERE 1 = 1
            and del_yn = 'N' 
        <if test="searchType != null and (searchType eq 'A'.toString()) and searchText != null and searchText"> 
            and code_id = #{searchText}::int
        </if>

    </select>


    <!--  코드상세 - selectCodeSearch -->
    <select id="selectCodeSearch" parameterType="Map" resultType="Map">

        SELECT
            code_id
            , codegroup_id
            , code_name
            , code_level
            , rank
            , description
            , create_id
            , to_char(create_dt,'YYYY-MM-DD hh24:mi:ss') as create_dt
            , update_id
            , to_char(update_dt,'YYYY-MM-DD hh24:mi:ss') as update_dt
            , del_yn
            , ROW_NUMBER() OVER( order by code_id ) as RNUM 
        FROM sdp.tb_code
        WHERE 1 = 1
            and del_yn = 'N' 
        <if test="searchType != null and (searchType eq 'A'.toString()) and searchText != null and searchText"> 
            and code_id = #{searchText}::int
        </if>

    </select>


    <!--  코드상세 - insertCode -->
    <insert id="insertCode" parameterType="Map">
        INSERT INTO
        sdp.tb_code(
            codegroup_id
            , code_name
            , code_level
            , rank
            , description
            , create_id
            , create_dt
            , update_id
            , update_dt
            , del_yn
        )
        VALUES(
            #{codegroup_id}::int
            , #{code_name}
            , #{code_level}::int
            , #{rank}::int
            , #{description}
            , #{create_id}::int
            , now()
            , #{update_id}::int
            , #{update_dt}
            , 'N' 
        )
    </insert>


    <!--  코드상세 - updateCode -->
    <update id="updateCode" parameterType="Map">
        UPDATE sdp.tb_code
        SET
            codegroup_id = #{codegroup_id}::int
            , code_name = #{code_name}
            , code_level = #{code_level}::int
            , rank = #{rank}::int
            , description = #{description}
            , create_id = #{create_id}::int
            , update_id = #{update_id}::int
            , update_dt = now()
            , del_yn = #{del_yn}
        WHERE code_id = #{code_id}::int
    </update>


    <!--  코드상세 - deleteCode -->
    <delete id="deleteCode" parameterType="Map">
        UPDATE sdp.tb_code
        SET
            del_yn = 'Y' 
        WHERE code_id = #{code_id}::int
    </delete>

</mapper>
